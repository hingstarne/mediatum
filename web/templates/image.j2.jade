- macro imageviewer(flash, svg_url, width, height, image_url, tileurl, no_flash_url)
  html
    head
      title
        = _t('popup_full_view')
      style(type='text/css').
        #div_image{
          overflow: auto;
          height: 300px;
          width: 200px;
        }
        body{
          margin: 0px;
          font-family: Verdana, Arial, Helvetica, sans-serif;
          vertical-align: top;
          font-size: 11px;
        }
      script(type='text/javascript').
        var h,w;
        var imageH = 0;
        var imageW = 0;
        var percentage = 100;
        var winW = 0;
        var winH = 0;
        var offsetH = 0;
        var offsetW = 0;
        var factor = 1;
        function load_image(image_url){
          getSize();
          img = new Image();
          img.src=(image_url);
          imageW = img.width;
          imageH = img.height;
          delete img;
          if (winW < imageW || winH < imageH){
            factor = winH / (imageH+20);
            if (factor > winW/ (imageW)){
              factor = winW / (imageW+20);
            }
          }
          zoom(0);
        }
        function load_svg(wo, ho){
          getSize();
          imageW = wo;
          imageH = ho;
          zoom(0);
        }
        function zoom(direction){
          if (direction == 0){
            percentage=100;
          }else{
            percentage = Math.abs(percentage - (direction * 10));
          }
          h = Math.floor(imageH * factor * (percentage / 100));
          w = Math.floor(imageW * factor * (percentage / 100));
          document.getElementById('myimage').style.width = w;
          document.getElementById('myimage').style.height = h;
          document.getElementById('zoom_val').innerHTML = percentage + " %";
          document.getElementById('nav').style.width = Math.floor((offsetW + w+2)/percentage*100-30)+"px";
          if (offsetW + w + 2 < screen.width && offsetH + h + 2 < screen.height){
            self.resizeTo(offsetW + w+2, offsetH + h+2);
            document.getElementById('nav').style.width = (offsetW + w+2-30) + "px";
          }
          self.moveTo(0,0);
        }
        function getSize(){
          self.resizeTo(screen.width, screen.height);
          if (parseInt(navigator.appVersion)>3) {
            if (navigator.appName=="Netscape") {
              winW = window.innerWidth;
              winH = window.innerHeight;
            }
          }
          if (navigator.appName.indexOf("Microsoft")!=-1) {
            winW = document.body.offsetWidth;
            winH = document.body.offsetHeight;
          }
          offsetH = screen.height - winH;
          offsetW = screen.width - winW;
        }
    if svg_url
      body(onload='load_svg(\'{}\', \'{}\')'.format(width, height), style='padding: 0px; border: 0px; margin: 0px;')
        #nav(align='left', name='nav', style='position:absolute; width: 300px; height:200px; margin:5px;')
          a(href='#', onclick='zoom(1);', title=_t('popup_fullview_decrease'))
            img(src='/img/pmud-minus.png', border='0')
          span#zoom_val(style='border:1px solid silver; background-color:white; width: 40px; text-align: right;') 100%
          a(href='#', onclick='zoom(-1);', title=_t('popup_fullview_increase'))
            img(src='/img/pmud-plus.png', border='0')
          a(href='#', onclick='zoom(0);', title=_t('popup_fullview_original'))
            img(src='/img/pmud-up.png', border='0')
          | &nbsp;&nbsp;
        #div_image(name='div_image', style='height: 100%; width: 100%;')
          img#myimage(src=svg_url, width='200px')
    if not flash and not svg_url
      body(onload='load_image(\'{}\')'.format(image_url), style='padding: 0px; border: 0px; margin: 0px;')
        #nav(align='right', name='nav', style='position:absolute; width: 300px; height:200px; margin:5px;')
          a(href='#', onclick='zoom(1);', title=_t('popup_fullview_decrease'))
            img(src='/img/pmud-minus.png', border='0')
          span#zoom_val(style='border:1px solid silver; background-color:white; width: 40px; text-align: right;') 100%
          a(href='#', onclick='zoom(-1);', title=_t('popup_fullview_increase'))
            img(src='/img/pmud-plus.png', border='0')
          a(href='#', onclick='zoom(0);', title=_t('popup_fullview_original'))
            img(src='/img/pmud-up.png', border='0')
          | &nbsp;&nbsp;
        #div_image(name='div_image', style='height: 100%; width: 100%;')
          img#myimage(src=image_url, width='200px')
    if flash and not svg_url
      body
        a(href=no_flash_url)
          = _t('image_no_flash_link')
        object#theMovie(
          classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'
          codebase='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0'
          width='100%'
          height='100%'
        )
          param(name='FlashVars', value='zoomifyImagePath={}'.format(tileurl))
          param(name='MENU', value='FALSE')
          param(name='SRC', value='/img/zoom.swf')
          embed(
            FlashVars='zoomifyImagePath={}'.format(tileurl)
            src='/img/zoom.swf'
            menu='false'
            pluginspage='http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash'
            width='100%'
            height='100%'
            name='theMovie'
          )
